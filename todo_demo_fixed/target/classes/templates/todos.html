<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TODOアプリ</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
<meta name="_csrf" th:content="${_csrf.token}" />
<meta name="_csrf_header" th:content="${_csrf.headerName}" />
</head>
<body>
<div class="container-fluid px-3 px-sm-4 py-3">
  <div class="row justify-content-center">
    <div class="col-12 col-md-8 col-lg-6">
      <div class="card shadow">
        <div class="card-header bg-primary text-white text-center">
          <h1 class="h3 mb-0"><i class="bi bi-check2-square me-2"></i>TODOリスト</h1>
        </div>
        <div class="card-body">

          <!-- TODO追加 -->
          <form th:action="@{/todos/add}" method="post" class="mb-4">
            <div class="input-group">
              <input type="text" name="task" class="form-control" placeholder="新しいTODOを入力..." required>
              <button type="submit" class="btn btn-primary"><i class="bi bi-plus-lg"></i> <span class="d-none d-sm-inline ms-1">追加</span></button>
            </div>
          </form>

          <!-- フィルターボタン -->
          <div class="btn-group mb-3 d-flex" role="group">
            <button type="button" class="btn btn-outline-primary flex-fill active" id="filterAll">
              すべて <span id="countAll" class="badge bg-dark ms-1">0</span>
            </button>
            <button type="button" class="btn btn-outline-primary flex-fill" id="filterIncomplete">
              未完了 <span id="countIncomplete" class="badge bg-warning text-dark ms-1">0</span>
            </button>
            <button type="button" class="btn btn-outline-primary flex-fill" id="filterComplete">
              完了 <span id="countComplete" class="badge bg-success ms-1">0</span>
            </button>
          </div>

          <!-- TODOリスト -->
          <ul class="list-group mb-3" id="todoList">
            <li th:each="todo : ${todos}" 
                class="list-group-item d-flex justify-content-between align-items-start"
                th:data-done="${todo.done}" th:data-id="${todo.id}">
              <div class="form-check flex-grow-1">
                <input class="form-check-input todo-checkbox" type="checkbox"
                       th:id="'todo'+${todo.id}" th:value="${todo.id}" th:checked="${todo.done}">
                <label class="form-check-label w-100" th:for="'todo'+${todo.id}">
                  <div>
                    <span th:text="${todo.task}" 
                          th:classappend="${todo.done} ? 'text-decoration-line-through text-muted'"></span>
                  </div>
                  <small class="text-muted" th:text="${#temporals.format(todo.createdAt, 'MM/dd HH:mm')}"></small>
                </label>
              </div>
              <div class="ms-2">
                <button type="button" class="btn btn-sm btn-outline-secondary editBtn"><i class="bi bi-pencil"></i></button>
                <button type="button" class="btn btn-sm btn-outline-danger deleteBtn"><i class="bi bi-trash"></i></button>
              </div>
            </li>
          </ul>

          <!-- 一括操作 -->
          <div class="d-flex justify-content-between">
            <button type="button" id="toggleAllBtn" class="btn btn-sm btn-outline-secondary"><i class="bi bi-check-all"></i> すべて完了/未完了</button>
            <button type="button" id="deleteSelectedBtn" class="btn btn-sm btn-outline-danger"><i class="bi bi-trash"></i> 選択TODOを削除</button>
          </div>
        </div>

        <div class="card-footer text-center">
          <form th:action="@{/logout}" method="post" class="d-inline">
            <button type="submit" class="btn btn-outline-secondary btn-sm"><i class="bi bi-box-arrow-right"></i> ログアウト</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="/js/todo.js"></script>
</body>
</html>
